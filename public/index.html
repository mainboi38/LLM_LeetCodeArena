<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI LeetCode Battle Arena</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e1e1e 0%, #2a2a2a 100%);
            padding: 20px;
            border-bottom: 2px solid #00ff41;
            box-shadow: 0 4px 20px rgba(0, 255, 65, 0.2);
        }

        .header h1 {
            text-align: center;
            font-size: 2.5rem;
            background: linear-gradient(90deg, #00ff41, #00ffaa, #41ff00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(0, 255, 65, 0.5);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { filter: brightness(1); }
            to { filter: brightness(1.2); }
        }

        .controls {
            padding: 20px;
            background: #1a1a1a;
            border-bottom: 1px solid #333;
        }

        .problem-section {
            padding: 20px;
            background: #1a1a1a;
            margin-bottom: 20px;
        }

        .problem-input {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            background: #0d0d0d;
            border: 1px solid #333;
            border-radius: 8px;
            color: #e0e0e0;
            font-family: 'Fira Code', 'Courier New', monospace;
            resize: vertical;
            transition: all 0.3s;
        }

        .problem-input:focus {
            outline: none;
            border-color: #00ff41;
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.2);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 30px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00ff41, #00cc33);
            color: #0a0a0a;
            box-shadow: 0 4px 15px rgba(0, 255, 65, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 255, 65, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #ff6b00, #ff8c00);
            color: #fff;
            box-shadow: 0 4px 15px rgba(255, 107, 0, 0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 0, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .models-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .model-card {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s;
        }

        .model-card:hover {
            border-color: #00ff41;
            box-shadow: 0 0 25px rgba(0, 255, 65, 0.2);
        }

        .model-header {
            background: linear-gradient(135deg, #2a2a2a, #1e1e1e);
            padding: 15px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .model-selector {
            padding: 8px 12px;
            background: #0d0d0d;
            border: 1px solid #00ff41;
            border-radius: 5px;
            color: #00ff41;
            cursor: pointer;
            transition: all 0.3s;
        }

        .model-selector:hover {
            background: #00ff41;
            color: #0a0a0a;
        }

        .model-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-idle {
            background: #333;
            color: #999;
        }

        .status-thinking {
            background: linear-gradient(135deg, #ff6b00, #ff8c00);
            color: #fff;
            animation: pulse 1.5s infinite;
        }

        .status-complete {
            background: linear-gradient(135deg, #00ff41, #00cc33);
            color: #0a0a0a;
        }

        .status-evaluating {
            background: linear-gradient(135deg, #00ccff, #0099ff);
            color: #fff;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .model-content {
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
        }

        .model-content::-webkit-scrollbar {
            width: 8px;
        }

        .model-content::-webkit-scrollbar-track {
            background: #0d0d0d;
        }

        .model-content::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 4px;
        }

        .model-content::-webkit-scrollbar-thumb:hover {
            background: #00ff41;
        }

        .solution-section, .evaluation-section {
            margin-bottom: 20px;
        }

        .section-title {
            color: #00ff41;
            font-size: 1.1rem;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #333;
        }

        .code-block {
            background: #0d0d0d;
            border: 1px solid #222;
            border-radius: 6px;
            padding: 15px;
            font-family: 'Fira Code', 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-x: auto;
        }

        .evaluation-content {
            background: #0d0d0d;
            border-left: 3px solid #00ccff;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
        }

        .evaluation-score {
            display: inline-block;
            padding: 5px 10px;
            background: linear-gradient(135deg, #00ccff, #0099ff);
            color: #fff;
            border-radius: 20px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 255, 65, 0.3);
            border-radius: 50%;
            border-top-color: #00ff41;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid #ff0000;
            color: #ff6666;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }

        .info-banner {
            background: linear-gradient(135deg, rgba(0, 255, 65, 0.1), rgba(0, 204, 51, 0.1));
            border: 1px solid #00ff41;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 0.95rem;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üöÄ AI LeetCode Battle Arena üöÄ</h1>
    </div>

    <div class="controls">
        <div class="info-banner">
            ‚ö° Select AI models and test their coding abilities with blind peer reviews!
        </div>
    </div>

    <div class="problem-section">
        <h2 style="color: #00ff41; margin-bottom: 15px;">üìù LeetCode Problem</h2>
        <textarea class="problem-input" id="problem-input" placeholder="Paste your LeetCode problem here...

Example:
Given an array of integers nums and an integer target, return indices of the two numbers such that they add up to target.

You may assume that each input would have exactly one solution, and you may not use the same element twice.

Example:
Input: nums = [2,7,11,15], target = 9
Output: [0,1]"></textarea>
        
        <div class="action-buttons">
            <button class="btn btn-primary" id="solve-btn" onclick="solveProblem()">
                üéØ Solve Problem
            </button>
            <button class="btn btn-secondary" id="evaluate-btn" onclick="evaluateSolutions()" disabled>
                üîç Blind Peer Review
            </button>
        </div>
    </div>

    <div class="models-grid" id="models-grid">
        <!-- Model cards will be dynamically generated here -->
    </div>

    <script>
        // Available models configuration - using current model names
        const availableModels = {
            openai: ['o3', 'gpt-5', 'gpt-4-turbo-preview', 'gpt-4', 'gpt-3.5-turbo', 'o1-preview', 'o1-mini'],
            anthropic: ['claude-opus-4-1-20250805', 'claude-3-opus-20240229', 'claude-3-sonnet-20240229', 'claude-3-haiku-20240307']
        };

        // Store model solutions
        let modelSolutions = {};
        let modelEvaluations = {};

        // Initialize 4 model cards
        function initializeModelCards() {
            const grid = document.getElementById('models-grid');
            grid.innerHTML = '';
            
            for (let i = 1; i <= 4; i++) {
                const card = document.createElement('div');
                card.className = 'model-card';
                card.id = `model-${i}`;
                card.innerHTML = `
                    <div class="model-header">
                        <select class="model-selector" id="model-select-${i}">
                            <option value="">Select Model</option>
                            <optgroup label="OpenAI">
                                ${availableModels.openai.map(m => `<option value="openai:${m}">${m}</option>`).join('')}
                            </optgroup>
                            <optgroup label="Anthropic">
                                ${availableModels.anthropic.map(m => `<option value="anthropic:${m}">${m}</option>`).join('')}
                            </optgroup>
                        </select>
                        <span class="model-status status-idle" id="status-${i}">Idle</span>
                    </div>
                    <div class="model-content" id="content-${i}">
                        <div style="text-align: center; color: #666; padding: 40px;">
                            Select a model and click "Solve Problem" to begin
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            }
        }

        // API call function - no API keys needed!
        async function callModel(provider, model, prompt, isEvaluation = false, targetSolution = null) {
            const endpoint = isEvaluation ? '/api/evaluate' : '/api/solve';
            
            const response = await fetch(`http://localhost:3000${endpoint}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    provider,
                    model,
                    problem: prompt,
                    solution: targetSolution
                })
            });
            
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || `API call failed: ${response.statusText}`);
            }
            
            const data = await response.json();
            return isEvaluation ? data : data.solution;
        }

        async function solveProblem() {
            const problem = document.getElementById('problem-input').value;
            if (!problem.trim()) {
                alert('Please enter a LeetCode problem first!');
                return;
            }

            // Reset solutions
            modelSolutions = {};
            modelEvaluations = {};
            
            // Disable buttons during solving
            document.getElementById('solve-btn').disabled = true;
            document.getElementById('evaluate-btn').disabled = true;

            // Process each selected model
            const promises = [];
            for (let i = 1; i <= 4; i++) {
                const selector = document.getElementById(`model-select-${i}`);
                const selected = selector.value;
                
                if (selected) {
                    promises.push(solveWithModel(i, selected, problem));
                }
            }

            await Promise.all(promises);
            
            // Enable evaluation if we have at least 2 solutions
            if (Object.keys(modelSolutions).length >= 2) {
                document.getElementById('evaluate-btn').disabled = false;
            }
            
            document.getElementById('solve-btn').disabled = false;
        }

        async function solveWithModel(modelNum, modelConfig, problem) {
            const [provider, model] = modelConfig.split(':');
            const statusEl = document.getElementById(`status-${modelNum}`);
            const contentEl = document.getElementById(`content-${modelNum}`);
            
            // Update status
            statusEl.className = 'model-status status-thinking';
            statusEl.textContent = 'Solving...';
            
            // Clear previous content
            contentEl.innerHTML = '<div class="loading"></div> Generating solution...';
            
            try {
                const solution = await callModel(provider, model, problem);
                
                modelSolutions[modelNum] = {
                    model: modelConfig,
                    solution: solution
                };
                
                // Display solution
                contentEl.innerHTML = `
                    <div class="solution-section">
                        <div class="section-title">üí° Solution</div>
                        <div class="code-block">${solution}</div>
                    </div>
                `;
                
                statusEl.className = 'model-status status-complete';
                statusEl.textContent = 'Solved';
            } catch (error) {
                contentEl.innerHTML = `<div class="error-message">Error: ${error.message}</div>`;
                statusEl.className = 'model-status status-idle';
                statusEl.textContent = 'Error';
            }
        }

        async function evaluateSolutions() {
            document.getElementById('evaluate-btn').disabled = true;
            
            // Create evaluation assignments (round-robin style)
            const modelNums = Object.keys(modelSolutions);
            
            if (modelNums.length < 2) {
                alert('Need at least 2 models to perform evaluations!');
                document.getElementById('evaluate-btn').disabled = false;
                return;
            }
            
            // Create a circular evaluation chain
            // Model 1 -> evaluates Model 2
            // Model 2 -> evaluates Model 3
            // Model 3 -> evaluates Model 4
            // Model 4 -> evaluates Model 1
            const evaluations = {};
            for (let i = 0; i < modelNums.length; i++) {
                const evaluator = modelNums[i];
                const target = modelNums[(i + 1) % modelNums.length]; // Next model in circle
                evaluations[evaluator] = target;
            }
            
            // Log the evaluation assignments for clarity
            console.log('Evaluation assignments:');
            for (let [evaluator, target] of Object.entries(evaluations)) {
                const evaluatorModel = modelSolutions[evaluator].model.split(':')[1];
                const targetModel = modelSolutions[target].model.split(':')[1];
                console.log(`Model #${evaluator} (${evaluatorModel}) ‚Üí evaluates ‚Üí Model #${target} (${targetModel})`);
            }
            
            // Perform evaluations
            const promises = [];
            for (let [evaluator, target] of Object.entries(evaluations)) {
                promises.push(performEvaluation(evaluator, target));
            }
            
            await Promise.all(promises);
            document.getElementById('evaluate-btn').disabled = false;
        }

        async function performEvaluation(evaluatorNum, targetNum) {
            const statusEl = document.getElementById(`status-${evaluatorNum}`);
            const contentEl = document.getElementById(`content-${evaluatorNum}`);
            
            statusEl.className = 'model-status status-evaluating';
            statusEl.textContent = 'Evaluating...';
            
            try {
                const evaluatorModel = modelSolutions[evaluatorNum].model;
                const targetSolution = modelSolutions[targetNum].solution;
                const problem = document.getElementById('problem-input').value;
                
                const [provider, model] = evaluatorModel.split(':');
                const targetModelName = modelSolutions[targetNum].model.split(':')[1];
                
                const evaluation = await callModel(
                    provider, 
                    model, 
                    problem,
                    true, 
                    targetSolution
                );
                
                // Display evaluation with clear labeling
                const evaluationHTML = `
                    <div class="evaluation-section">
                        <div class="section-title">üìä Evaluating Model #${targetNum} (${targetModelName})</div>
                        <div class="evaluation-content">
                            <div style="color: #888; font-size: 0.85rem; margin-bottom: 10px;">
                                ‚Ü≥ This model (${model}) is evaluating ${targetModelName}'s solution
                            </div>
                            <span class="evaluation-score">Score: ${evaluation.score}</span>
                            <p><strong>Critique:</strong> ${evaluation.critique}</p>
                            <p><strong>Improvements:</strong> ${evaluation.improvements}</p>
                            <p><strong>Verdict:</strong> ${evaluation.verdict}</p>
                        </div>
                    </div>
                `;
                
                const existingSolution = contentEl.querySelector('.solution-section');
                if (existingSolution) {
                    contentEl.innerHTML = existingSolution.outerHTML + evaluationHTML;
                } else {
                    contentEl.innerHTML = evaluationHTML;
                }
                
                statusEl.className = 'model-status status-complete';
                statusEl.textContent = 'Evaluated';
            } catch (error) {
                contentEl.innerHTML += `<div class="error-message">Evaluation error: ${error.message}</div>`;
                statusEl.className = 'model-status status-idle';
                statusEl.textContent = 'Error';
            }
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            initializeModelCards();
        });
    </script>
</body>
</html>